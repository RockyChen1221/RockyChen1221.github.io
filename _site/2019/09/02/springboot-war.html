<!doctype html>
<head>

  <!-- Meta -->
  <meta charset="utf-8">

  <title>Spring Boot打war启动(EasyReport) - NoteBook</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="NoteBook - 记录自己在实践过程中遇到的困难，如内容能帮到您，实属荣幸" href="http://localhost:4000/feed.xml">
  <link rel="alternate" type="application/atom+xml" title="NoteBook - 记录自己在实践过程中遇到的困难，如内容能帮到您，实属荣幸" href="http://localhost:4000/atom.xml">

  <!-- Favicons -->
  <link rel="icon" href="http://localhost:4000/img/favicon.png">

  <!-- Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,400italic,700|Merriweather:400,300,300italic,400italic,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  <!-- Styles -->
  <link rel="stylesheet" href="/css/animate.min.css">
  <link rel="stylesheet" href="/css/style.css">

</head>
<body class="">

<div class="main container" id="top">

  
  <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
          <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="/">rockychen</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              
                <li>
                  <a href="/">Home</a>
                </li>
              
                <li>
                  <a href="/books">Books</a>
                </li>
              
                <li>
                  <a href="/about">About</a>
                </li>
              
            </ul>
          </div>
      </div>
  </nav>
  


  <article class="markdown-body entry-content p-3 p-md-6">


	<h2 id="spring-boot打war启动easyreport">Spring Boot打war启动(EasyReport)</h2>

<p>前言：为了方便部署和统一管理，同时节约服务器端口资源，故将jar方式更改为采取war方式打包</p>

<h3 id="pomxml">POM.xml</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring-boot.version}<span class="nt">&lt;/version&gt;</span>
            <span class="c">&lt;!-- 这里指定打包的时候不再需要tomcat相关的包 --&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.embed<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>tomcat-embed-core<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- servlet api --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${javax.servlet.api.version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h3 id="启动类">启动类</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebApplication</span> <span class="kd">extends</span> <span class="nc">SpringBootServletInitializer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">WebApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">SpringApplicationBuilder</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">SpringApplicationBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">sources</span><span class="o">(</span><span class="nc">WebApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="遇到的问题">遇到的问题</h3>

<ol>
  <li>
    <p>碰到一个外观模式注入的Service，使用<code class="highlighter-rouge">@Resource</code> 注入一直是失败的，用jar方式没问题，后改用<code class="highlighter-rouge">@Autowired</code>注入启动成功</p>
  </li>
  <li>
    <p>由于之前采取jar方式启动，URL只到端口层，故项目中请求正常，换成war后，由于带上了工程名称，ajax请求默认不包含工程名，导致部分请求404</p>
  </li>
</ol>

<p>传统的jsp页面js获取项目路径的写法：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">contextPath</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">${pageContext.request.getContextPath()}</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>
<p>springboot thymeleaf js获取项目路径：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">th</span><span class="p">:</span><span class="nx">inline</span><span class="o">=</span><span class="dl">"</span><span class="s2">javascript</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="cm">/*&lt;![CDATA[*/</span>
        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="cm">/*[[@{/}]]*/</span><span class="p">;</span>
        <span class="cm">/*]]&gt;*/</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>


    <!--<div class="container">
      <div class="row">
        <div class="col-md-8 col-md-offset-2">

          

        </div>
      </div>
    </div>-->
  </article>


    <footer class="site-footer">
      <div class="container">
        <div class="row">

          <div class="col-xs-12 col-md-2 col-md-offset-1">
            <p class="text-muted text-left "><a href="http://localhost:4000">© 2019 rockychen</a></p>
          </div>

          <div class="col-xs-12 col-md-6 col-md-offset-2">
            <a class="section-jump" href="#top">
              <i class="fa fa-angle-up fa-3x"></i>
            </a>
          </div>
        </div>
      </div>
    </footer>

  </div><!-- .main.container -->

    <!-- JavaScript -->
    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://localhost:4000/js/wow.min.js"></script>
    <script src="http://localhost:4000/js/app.js"></script>


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', ' UA-9999999-99', 'auto');
      ga('send', 'pageview');

    </script>

    </body>
</html>

